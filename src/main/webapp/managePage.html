<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ç”¨æˆ·ç®¡ç†</title>
    <link rel="stylesheet" href="views/layui/css/layui.css" media="all">
    <script src="views/layui/layui.js" charset="utf-8"></script>
    <script src="statics/js/jquery-3.3.1.min.js"></script>
</head>
<style>
     .layui-form-item {
         margin-left: -5px;
     }

     .layui-form-label {
         width: 70px;
         margin-left: -15px;
     }

     .layui-input {
     }

     .layui-input-inline {
     }

     .layui-input {
     }

</style>
</head>
<body class="layui-layout-body" onload="getTime()">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">
            <img src="statics/png/coca-cola.png" style="width: 60%"/>
        </div>
        <!-- å¤´éƒ¨åŒºåŸŸï¼ˆå¯é…åˆlayuiå·²æœ‰çš„æ°´å¹³å¯¼èˆªï¼‰ -->
        <ul class="layui-nav layui-layout-left">

            <span class="layui-nav-bar" style="left: 102px; top: 55px; width: 0px; opacity: 0;"></span></ul>
        <ul class="layui-nav layui-layout-right" style="margin-right: 0%">
            <li class="layui-nav-item"><a id="timeShow" href=""></a></li>
            <li class="layui-nav-item"><a href="">ä½ å¥½ï¼Œadminï¼Œæ¬¢è¿ç™»é™†</a></li>
            <li class="layui-nav-item"><a href="">é€€å‡º</a></li>
            <span class="layui-nav-bar" style="left: 132px; top: 55px; width: 0px; opacity: 0;"></span></ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- å·¦ä¾§å¯¼èˆªåŒºåŸŸï¼ˆå¯é…åˆlayuiå·²æœ‰çš„å‚ç›´å¯¼èˆªï¼‰ -->
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a class="" href="http://127.0.0.1:8080/manage" style="text-align: center">ç³»ç»Ÿç®¡ç†<span
                            class="layui-nav-more"></span></a>
                    <dl class="layui-nav-child">
                        <dd><a href="" style="text-align: right">ç”¨æˆ·ä¿¡æ¯ç®¡ç†</a></dd>
                    </dl>
                </li>
                <span class="layui-nav-bar"></span></ul>
        </div>
    </div>

    <div class="layui-body">
        <!-- å†…å®¹ä¸»ä½“åŒºåŸŸ -->
        <br><br>
        <form class="layui-form" action="" style="">
            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">å­¦å·</label>
                <div class="layui-input-inline">
                    <input type="text" name="no" id="no"
                           placeholder="" autocomplete="off" class="layui-input">
                </div>
                <label class="layui-form-label">å­¦ç”Ÿå§“å</label>
                <div class="layui-input-inline">
                    <input type="text" name="name" id="name"
                           placeholder="" autocomplete="off" class="layui-input">
                </div>
                <label class="layui-form-label">å­¦ç”ŸçŠ¶æ€</label>
                <div class="layui-input-inline">
                    <select name="status" id="status">
                        <option value=""></option>
                        <option value="å¯ç”¨">å¯ç”¨</option>
                        <option value="ç¦ç”¨">ç¦ç”¨</option>
                        <option value="é»‘åå•">é»‘åå•</option>
                    </select>
                </div>
                <label class="layui-form-label">æ³¨å†Œæ¸ é“</label>
                <div class="layui-input-inline">
                    <select name="access" id="access">
                        <option value=""></option>
                        <option value="PCç«¯">PCç«¯</option>
                        <option value="å¾®ä¿¡å…¬ä¼—å·ç«¯">å¾®ä¿¡å…¬ä¼—å·ç«¯</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item layui-inline">
                <label class="layui-form-label">åˆ›å»ºèµ·å§‹</label>
                <div class="layui-input-inline">
                    <input type="text" name="date" id="begin"
                           placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                </div>
                <label class="layui-form-label">åˆ›å»ºæˆªæ­¢</label>
                <div class="layui-input-inline">
                    <input type="text" name="date" id="end"
                           placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-inline">
                    <button class="layui-btn layui-btn-normal " id="queryBtn" type="button"
                            style=" width:80px;margin-left: 50px;margin-right: 20px">æŸ¥è¯¢
                    </button>
                    <button class="layui-btn layui-btn-normal " id="cancel" type="button"
                            href="" style="width:80px">å–æ¶ˆ
                    </button>
                </div>
            </div>

        </form>
        <fieldset class="layui-elem-field layui-field-title"
                  style="margin: 20px">
        </fieldset>
        <div style="margin: 20px">
            <button class="layui-btn layui-btn-sm layui-btn-normal "><i class="layui-icon layui-icon-edit"
                                                                        style="vertical-align: middle"></i> æ›´æ”¹çŠ¶æ€
            </button>
            <button id="resetPsd" class="layui-btn layui-btn-sm layui-btn-normal"><i
                    class="layui-icon layui-icon-refresh"
                    style="vertical-align: middle"></i> é‡ç½®å¯†ç 
            </button>
            <button class="layui-btn layui-btn-sm "><i class="layui-icon layui-icon-add-circle"
                                                       style="vertical-align: middle"></i> æ–°å»º
            </button>
        </div>
        <fieldset class="layui-elem-field layui-field-title" style="margin: 20px;">
        </fieldset>
        <table class="layui-table" id="table" style="" lay-skin="line" lay-filter="demo"></table>
    </div>
</div>
</div>
<script language="javascript" type="text/javascript">

    layui.use('laydate', function () {
        var form = layui.form
            , laydate = layui.laydate;

        //æ—¥æœŸ
        laydate.render({
            elem: '#begin'
        });
        laydate.render({
            elem: '#end'
        });
    })
    layui.use('table', tableD)

    function getNow(s) {
        return s < 10 ? '0' + s : s;
    }

    function getTime() {
        var timeShow = document.getElementById("timeShow")
        var myDate = new Date();
        //è·å–å½“å‰å¹´
        var year = myDate.getFullYear();
        //è·å–å½“å‰æœˆ
        var month = myDate.getMonth() + 1;
        //è·å–å½“å‰æ—¥
        var date = myDate.getDate();
        var h = myDate.getHours();       //è·å–å½“å‰å°æ—¶æ•°(0-23)
        var m = myDate.getMinutes();     //è·å–å½“å‰åˆ†é’Ÿæ•°(0-59)
        var s = myDate.getSeconds();

        var now = year + '-' + getNow(month) + "-" + getNow(date) + " " + getNow(h) + ':' + getNow(m) + ":" + getNow(s);
        timeShow.text = now
    }

    function createTime(data) {
        var date = new Date(data);
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        m = m < 10 ? '0' + m : m;
        var d = date.getDate();
        d = d < 10 ? ("0" + d) : d;
        var h = date.getHours();
        h = h < 10 ? ("0" + h) : h;
        var M = date.getMinutes();
        M = M < 10 ? ("0" + M) : M;
        var str = y + "-" + m + "-" + d + " " + h + ":" + M;
        return str;
    }

    $("#queryBtn").on("click", queryMethod)
    $("#resetPsd").on("click", resetPassword)

    allUserUrl = 'allUser'
    tableAllUrl = 'allUserTable';
    queryUserUrl = 'queryUser'
    tableQueryUrl = 'queryUserTable';
    resetPsdUrl = 'resetPsd'


    function tableD() {
        userTable = layui.table;
        userTable.render({
            elem: '#table'
            , url: tableAllUrl
            , page: true //å¼€å¯åˆ†é¡µ
            , limit: 4
            , limits: [4]
            , parseData: function (result) { //res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ®
                return {
                    "code": result.code,
                    "msg": result.msg,
                    "count": result.count,
                    "data": result.data.content
                };
            }
            //ç”¨äºå¯¹åˆ†é¡µè¯·æ±‚çš„å‚æ•°ï¼špageã€limité‡æ–°è®¾å®šåç§°
            , request: {
                pageName: 'page' //é¡µç çš„å‚æ•°åç§°ï¼Œé»˜è®¤ï¼špage
                , limitName: 'limit' //æ¯é¡µæ•°æ®é‡çš„å‚æ•°åï¼Œé»˜è®¤ï¼šlimit
            }
            , response: {
                statusCode: 200
                , countName: 'count'
            }
            , cols: [[
                {type: 'checkbox'}
                , {field: 'no', width: 140, title: 'å­¦å·', sort: true}
                , {field: 'name', width: 100, title: 'å­¦ç”Ÿå§“å', sort: true}
                , {field: 'collage', width: 100, title: 'æ‰€å±å­¦é™¢', sort: true}
                , {field: 'branch', width: 100, title: 'æ‰€å±éƒ¨é—¨', sort: true}
                , {field: 'major', width: 150, title: 'ä¸“ä¸šåç§°', sort: true}
                , {field: 'access', width: 100, title: 'æ³¨å†Œæ¸ é“', sort: true}
                , {
                    field: 'ct', width: 150, title: 'åˆ›å»ºæ—¶é—´', sort: true,
                    templet: function (row) {
                        return createTime(row.ct)
                    }
                }
                , {
                    field: 'ut', width: 150, title: 'æ›´æ–°æ—¶é—´', sort: true,
                    templet: function (row) {
                        return createTime(row.ut)
                    }
                }
                , {field: 'status', width: 100, title: 'å­¦ç”ŸçŠ¶æ€', sort: true}
                // , {field: 'manage', width: 60, title: 'æ“ä½œ'}
            ]]
        })
    }

    function tableQ() {
        userTable.reload('table', {
            url: tableQueryUrl
            , where: {
                no: inputNo,
                name: inputName,
                status: inputStatus,
                access: inputAccess,
                beginDate: selectBeginDate,
                endDate: selectEndDate
            } //è®¾å®šå¼‚æ­¥æ•°æ®æ¥å£çš„é¢å¤–å‚æ•°
            , page: {
                page: 1 //é‡æ–°ä»ç¬¬ 1 é¡µå¼€å§‹
            }
        });
    }

    function tableR() {
        userTable.on('checkbox(demo)', function (obj) {
        });
    }

    function queryMethod() {
        inputNo = $("#no").val()
        inputName = $("#name").val()
        inputStatus = $("#status").val()
        inputAccess = $("#access").val()
        selectBeginDate = $("#begin").val()
        selectEndDate = $("#end").val()
        json = {
            "no": inputNo,
            "name": inputName,
            "status": inputStatus,
            "access": inputAccess
        }
        if (selectBeginDate == "" && selectEndDate != "")
            layui.layer.msg('è¯·è¾“å…¥åˆ›å»ºæ—¶é—´â˜ºâ˜ºâ˜º')
        else if (selectBeginDate != "" && selectEndDate == "")
            layui.layer.msg('è¯·è¾“å…¥æˆªæ­¢æ—¶é—´â˜ºâ˜ºâ˜º')
        else {
            //æäº¤JSON
            $.ajax({
                type: "POST",
                url: queryUserUrl,
                data: json,
                dataType: "json",
                success: function (message) {
                    layui.layer.alert("æŸ¥è¯¢æˆåŠŸâ˜ºâ˜ºâ˜º")
                    layui.use('table', tableQ)
                },
                error: function (message) {
                    console.log(message);
                    layui.layer.alert("æŸ¥è¯¢å¤±è´¥")
                }
            })
        }
    }


    function resetPassword() {
        layui.use('table', tableR)
        checkStatus = userTable.checkStatus('table')
        users = checkStatus.data;
        var userList = {}
        var nos = []
        for (var i = 0; i < users.length; i++) {
            nos.push(users[i].no)
        }
        userList.nos = nos
        var json = {
            "userList": userList
        }
        $.ajax({
            type: "POST",
            url: resetPsdUrl,
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify(json),
            dataType: "json",
            success: function (message) {
                layui.layer.alert("é‡ç½®æˆåŠŸâ˜ºâ˜ºâ˜º")
            },
            error: function (message) {
                layui.layer.alert("é‡ç½®å¤±è´¥ğŸ˜­ğŸ˜­ğŸ˜­")
            }
        })

    }

    setInterval("getTime()", 1000);//è®©ä½ çš„æ—¶é—´æ¯1000såˆ·æ–°ä¸€æ¬¡
</script>
</body>
</html>